# Sujet Evaluation Python/OpenCV UV RobVis 2021-2022

Ce mini-sujet d'une heure comporte deux volets. Dans le premier (Etape 1 à 3), il s'agit de développer le script python capable de détecter les **objets présents**  (voiture, vélo, piéton etc.) dans une séquence d'images prise à partir la caméra de surveillance d'un carrefour. Il ne s'agira pas d'identifier la classe des objets mais simplement de les localiser dans chaque image de la séquence. Dans le second volet (Etape 4 à 5), je vous demande d'écrire le script capable de retrouver deux véhicules particuliers dans une séquence.

Pour cela, vous vous appuierez très majoritairement sur les codes que vous avez testés durant les séances de TP précédentes et tout particulièrement ce qui vous a été montré en matière de segmentation et de détection d'objets.

Vous ferez tous vos tests sur la vidéo que je vous ai fournie (***carrrefour.mp4***).

Tout le matériel nécessaire est téléchargeable ici : https://grosfi.ch/VRWqS7HTCNx
Si la vidéo du fichier zip ne fonctionne pas utlisez celui là : https://grosfi.ch/mKjPEPenXbZ

Le sujet peut vous sembler dense (et il l'est sûrement) mais je pense l'avoir très bien dirigé pour que vous vous en sortiez parfaitement bien.

Pour l'affichage des images en évitant les plantages avec ```cv2.imshow()``` , je vous conseille d'utiliser la classe pyplot de matplotlib:

```
from matplotlib import pyplot as plt

plt.figure(figsize=(5, 5),dpi=180) # pour jouer sur la taille de la figure
plt.imshow(mon_image) # pour afficher le buffer image mon_image
plt.title('Mettre un titre')
plt.show()

```

Attention c'est un travail individuel. Il est question d'évaluer ce que chacun d'entre vous a retenu de cette partie de l'UV.

## Volet 1 - étape 1

Afin de détecter les objets présents dans une image *t* de la séquence, un moyen simple est de faire la différence entre cette image *t*  et une image du "fond" vide i.e. acquise lorsqu'aucun objet n'est présent. Dans le cadre de ce carrefour, l'image de fond (***bg.png***) est l'image du carrefour sans aucun mobile le traversant. Pour faire une différence entre deux images vous utilserez la fonction ```cv.absdiff(im1,im2)``` qui calcule la valeur absolue de la différence de deux images : *diff* pour faire la différence et *abs* pour en faire la valeur absolue et éviter les valeur négative. Par conséquent, il est assez facile d'imaginer qu'elle sera le résultat d'une telle différence entre l'image d'une scène vide et l'image de la même scène avec des objets.

Attention, les images de la vidéo sont de résolution élevée et en couleur. Vous veillerez à réduire la taille des images en 640x480 et à les convertir en niveau de gris.

Dans cette première étape je vous demande donc de produire le script python qui réalise les actions suivantes :

- le chargement de l'image de fond ;
- l'ouverture et la lecture de la vidéo ;
- la différence entre l'image de fond et chaque image de la vidéo ;
- l'affichage de l'image et de l'image différence dans deux fenêtres différentes.

*A la fin de cette étape vous enregistrerez votre script sous le nom* **volet1_1_nom.py **

## Volet 1 - étape 2

Dans l'étape 1, vous avez réalisé la détection des objets présents dans la scène. Dans cette deuxième étape, je vous demande :
- de procéder (par binarisation) à la création du masque de chaque objet ;
- de nettoyer (supprimer les petites régions, le bruit etc.) ce masque avec des opérateurs morpholgiques (filtre médian, dilatation, fermeture etc.). Veillez à bien remplir toutes les formes ainsi détectées  ;
- de segmenter ce masque en plusieurs régions de pixels connexes ; 
- d'afficher tous les contours en vert sur l'image.

*A la fin de cette étape vous enregistrerez votre script sous le nom* **volet1_2_nom.py **

## Volet 1 - étape 3

Je vous demande de modifier la partie du code de l'étape 2 afin :
- d'appliquer le masque à l'image et d'afficher le résultat (vous devriez avoir en sortie une image dans laquelle seuls les objets sont présents et le reste des pixels sont noirs) ;
- dessiner et visualiser le contour des véhicules motorisés en rouge et les piétons en vert sur l'image couleur (taille réduite). Pour cela vous pourrez extraire des caractéristiques de forme sur les ensembles connexes trouvés précédemment. Il faut que vous choisissiez une (ou plusieurs) caractéristique qui permet de différencier un piéton et voiture (un indice ... sa surface par exemple)
- de compter dans chaque image et en les différenciant les véhicules motorisés et les piétons. Vous afficherez ces deux compteurs en haut à gauche de l'image couleur.

*A la fin de cette étape vous enregistrerez votre script sous le nom* **volet1_3_nom.py **

## Volet 2 - étape 1 

Vous entrez dans le volet 2. Dans cette étape je vous demande de modifier je vous demande d'écrire un script capable de retrouver l'un et l'autre des deux véhicules dans la séquence et uniquement ceux-là. Ces deux véhicules sont définis par les images suivantes : **moto.png** et **voiture.png**. Vous partirez du code fournis en TP2 et vous l'adapterez afin qu'il applique cette reconnaissance à chaque image de la séquence. Vous êtes libre d'utiliser soit une méthode fondée sur le matching d'image, soit une technique qui exploite le matching de feature ou une analyse de l'hitogramme. Vous veillerez à afficher une boite englobante autour des objets lorsque vous estimerez les avoir retrouvés dans les images.

*A la fin de cette étape vous enregistrerez votre script sous le nom* **volet2_1_nom.py **

## Volet 2 - étape 2

Vous aurez constaté que la redétection n'est pas toujours de bonne qualité en appliquant ces méthode de  reconnaissance à toute l'image. Dans cette étape, je vous demande de modifier le script de l'étape 4 afin que la reconnaissance soient opérée sur l'image à laquelle vous avez appliqué le mask de segmentation (cf. résultats de la question 1 du Volet 1 - etape 3). En réduisant ainsi le nombre de pixels d'intérêt, la redétection sera plus efficace.

A la fin de cette étape vous enregistrerez votre script sous le nom* **volet2_2_nom.py ** 


## A fournir en fin d'évaluation

Vous m'enverrai par email (sebastien.ambellouis@univ-eiffel.fr et sebastien.ambellouis@imt-nord-europe.fr) un fichier votre_nom.zip dans lequel vous placerez tous vos scripts Python. Vous avez jusque 16h15 pour me l'envoyer.

**BON COURAGE A VOUS !**
